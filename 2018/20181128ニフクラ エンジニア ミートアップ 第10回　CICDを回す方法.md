# ニフクラ エンジニア ミートアップ 第10回　CI/CDを回す方法

## 概要
* 日時: 2018/11/28
* 場所: 富士通クラウドテクノロジーズ株式会社


## session

-----
### CI/CD超入門
* Speeker: 宮原 徹（日本仮想化技術株式会社）

#### DevOpsを支える要素・技術
* 自動化
  - テストの自動化
  - インフラ構築の自動化
* 効率化
  - CI/CD
* チーム開発
  - 雲頂モデルに基づくバージョン管理
  - チケット駆動開発によるタスクの明確化
  - 同じ時間軸の中で開発していく

#### テスト自動化のメリット
* きちんと動いているかの担保
* 新機能の網羅

#### テスト自動化のデメリット
* 初期コストが高い
  - 経験者に入ってもらうといい
* 要求仕様が大きく変わるとテストコードに影響
  - テストファーストって相当固まってないと厳しく無い？

#### インフラ構築の自動化
* 手順書ベースによる構築の課題
  - 手間がかかる
    - 年一くらいならいいが…
* 自動化ツールによる構築
  - 誰が何度実行しても同じ結果になる
  - 誰がみても同じもになる

#### 継続的インテグレーション
* ビルド・テストを自動でやってくれる
* ツール
  - Jenkins
    - なんでもできる
      - なんでもできすぎて困る
  - GitLab
    - これは単体でOK
  - github
    - 他と連携した方がいい

#### 継続的デリバリー
* CIの仕組みをインフラ構築まで拡張
  - 開発者とインフラエンジニアのやりとりコストが削減
* インフラを含めた結合テストの自動化が可能
  - ライセンス関係があるとまだ課題がある

#### CI/CD/DevOps
* 単体テストまで
  - Ci
* インフラ構築/デプロイまで
  - CD
* 本番運用まで
  - DevOps

#### CI/CDを止める要因あるある
* 原因がわからないが止まってる
  - クラウドサービスほどわからない場合が多い
  - 再現性が低くやり直すとうまくいく
    - エラーハンドリング…
  - 毎日継続的に実行するようにすると発見が早くなる
* ネットワークに起因することが多い
  - リポジトリ先が死んでる
  - 名前解決関係が要因の場合もある
    - 新規メンバーのアカウント作成不足とか
    - 証明書とか


### ニフクラのサービス基盤運用におけるCIの取り組み
* Speaker: 伊藤将行（富士通クラウドテクノロジーズ株式会社）
* Slide:

#### CIについて
* 日常的に結合(インテグレーション)
  - 頻繁に行う必要性
    - ビルド・テストの自動化

#### CI実現に向けた課題
* CIテスト用の環境整備が必要
  - テスト自動化はCI実現の要
  - 良いテスト環境がないのはその妨げ
* テスト環境の難点
  - インフラのテスト環境は汚れやすい
  - 1から作って壊すを繰り返すには時間がかかる

#### Nested ESXIの活用
* ハイパーバイザ
  - 仮想マシン上で仮想マシンを
  - APIでいじれる
* テスト環境はネットワークを分離
  - 他の環境に影響がないように

#### 成果物
* テスト自体の自動化推進
  * Ansible playbookの自動テスト
    - ノウハウ
  * サービス挙動のテスト
  * 運用ツールのテスト
* デグレ発見
  - テスト自動化進めてる間は辛いが、効果はあった
* 開発環境を用意に作成できるようになった
* CDの実現はまだまだ

#### 最後に
* インフラ運用をソフトウェアと同一視できるようになってきた
  - ソフトウェア開発で培われた技術が応用可能になってきた


### mobile backendチームのCI
* Speaker: 山上慶子(富士通クラウドテクノロジーズ株式会社)
* Slide

#### ニフクラmobile backend
* スマホアプリのバックエンド機能のAPI化サービス提供
  - mBaaS

#### サービスサイト基盤運用をCI/CD化
* Github to Hosting
  - CircleCI導入
    - margeでFTPコマンド
      - ぐぐるとでてくる
#### Jenkins活用事例1
* 複雑な手作業手順の改善
  - Jenkins
  - PythonScript(Pandas)で集計
  - IncomingWebhookでSlack通知
* Good
  - ミスがなくなった
  - 集計時間短縮
  - 引き継ぎ容易

#### Jenkins活用事例2
* アラートジョブ
  - Jenkinsジョブを日曜に定期実行
  - Slackで共有
  - 怪しい事項をメール通知
* Good
  - 事前に問題点に気づけるようになった

#### まとめ
* 目的から対応を考えるといい


### a
* Speaker: CircleCI Kim (@kimhirokuni)
* Slide:

#### CI/CDスルト何が嬉しいの？
* バグを描いても怒られなくなる
  - テストできる範囲には制限がある
- リリースしないとどうなるかわからない…
  - 本番テスト
    - 失敗したらRevert
    - CI/CDがあるとリリースが楽になる(心理的)
- 1.バグを作ってもすぐに戻せる心理的安全
  - すぐに霧戻せる
- 2.リリースサイクルの短縮
- 3.いつでも戻せるコードを書く習慣をつく
  - ロールバックを念頭におく(後方互換を常に意識する)

#### やりたくなる
* フィーチャーフラグ
* ローリングアップデート
* リリースサイクル

#### まとめ
* より早く自由にプロダクト開発
* テストをすることは開発者(プロ)の責任


### インフラエンジニアのためCI/CD
* Speaker: かめねこ(@kameneko1004)
* Slide: a

#### CI/CDの技術要素
- インフラエンジニアの得意とする領域
  * コンテナ
  * 構成管理
- なので開発は開発に専念してもらった方がいい
  - という思い

#### 今後
* インフラエンジニアはコードが武器になる
  - クラウドネイティブな考え方によりインフラが抽象化され敷居が下がっている
  - 技術のｈ場を広げていく必要性
* CI/CDコンテナ、構成管理などがas Codeの代表例
  - 当たり前になる未来がある
- が、マストでない
  - コードで管理できる人が新しい仕事ができる
    - 生存戦略
